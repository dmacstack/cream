
<html ng-app = "creamApp">
  <head>
    <title> Edu Chat </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap-responsive.min.css">
      <style>
      body {
        padding-top: 60px;
      }
      #round_button {
        border-radius: 5px;
        float:right;
      }
      #message_div {
        overflow: scroll;
        height: 300px;
      }
      
      
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-route.min.js"></script>

    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <!--<script src="../node_modules/socket.io/socket.io.js"></script>-->
    <script src="/socket.io/socket.io.js"></script>
  
    <script>
    var creamApp = angular.module('creamApp', ['ngRoute']);

    creamApp.config(function($routeProvider){
      $routeProvider
      .when('/', {
        templateUrl: 'partials/login.html',
        controller: 'usersController'
      })
      .when('/chat', {
        templateUrl: 'partials/chat.html',
        controller: 'chatController'
      })
      .when('/video', {
        templateUrl: 'partials/video.html'
      })
      .otherwise({
        templateUrl: 'partials/login.html'
      });
    });
    
    //UserFactory 
    
      creamApp.factory('UserFactory', function($http, $location){
       var factory = {};
       var users = [];
        // users = [{name:'john'},{name:'jane'},{name:'joe'}];
       var currentUser = null;
        
        factory.addUser = function(callback, user){
          $http.post('/chat', user).then(function(response){
            currentUser = response.data;
            callback(currentUser);
          });
        };
        factory.getUser = function(callback){
          callback(currentUser);
        };
        return factory;
      });
        
      creamApp.controller('usersController', function($scope, UserFactory){
        $scope.addUser = function(user){
        UserFactory.addUser(function(currentUser){
          console.log(currentUser);
          $scope.newUser = {};
        });
      };
        UserFactory.getUser(function(userData){
          $scope.currentUser = userData;
        });
      });
      
    //ChatFactory
    
      creamApp.factory('ChatFactory', function($http, $location){
        factory = {};
        chats = [];
        return factory;
      });
   

     creamApp.controller('chatController', function($scope, ChatFactory) {
        var socket = io.connect();

        $scope.messages = [];
        $scope.roster = [];
        $scope.name = '';
        $scope.text = '';

        socket.on('connect', function () {
          $scope.setName();
        });

        socket.on('message', function (msg) {
          $scope.messages.push(msg);
          $scope.$apply();
        });

        socket.on('roster', function (names) {
          $scope.roster = names;
          $scope.$apply();
        });

        $scope.send = function send() {
          var elem = document.getElementById('message_div');
          elem.scrollTop = elem.scrollHeight;
          console.log('Sending message:', $scope.text);
          socket.emit('message', $scope.text);
          $scope.text = "";

        };

        $scope.setName = function setName() {
          socket.emit('identify', $scope.name);
        };
      });

    </script>
  </head>
  <body>
    <a href="#/"> Login Page </a> | <a href="#/chat"> Chat </a> | <a href="#/video"> Video </a>
    <div ng-view = "">
    <div id="container">
     
    </div>
    </div>


  </body>
</html>
